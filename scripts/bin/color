#!/usr/bin/env zsh

[[ $1 = -h || $1 == --help ]] && exec cat >&2 <<EOF
usage: ${0%%*/} [-h | --help | THEME]
Switch themes: update configuration file with symlinks and load them.
THEME can be light (or l), or dark (or dark)
EOF

if [[ $1 = light || $1 = l ]]; then
  THEME=light
  OLD_ICONS=Papirus-Dark NEW_ICONS=Papirus-Light
elif [[ $1 = dark || $1 = d ]]; then
  THEME=dark
  OLD_ICONS=Papirus-Light NEW_ICONS=Papirus-Dark
else
  THEME=$(< ~/.theme)
  [[ $THEME = light ]] && exec $0 dark || exec $0 light
fi

echo $THEME > ~/.theme

ln -sf ~/.config/bat/${THEME}_bat.conf ~/.config/bat/config
ln -sf ~/.config/zathura/${THEME}_zathurarc ~/.config/zathura/zathurarc
ln -sf ~/.config/kitty/kitty-${THEME}-scheme.conf ~/.config/kitty/color-scheme.conf
ln -sf ~/Pictures/${THEME}.png ~/Pictures/wallpaper.png

sed -i "s/$OLD_ICONS/$NEW_ICONS/" ~/.config/gtk-3.0/settings.ini
sed -i "s/$OLD_ICONS/$NEW_ICONS/" ~/.config/xsettingsd/xsettingsd.conf

{
  hsetroot -cover ~/Pictures/wallpaper.png
  kill -SIGUSR1 $(pidof nvim)
  kill -SIGUSR1 $(pidof kitty)
  awesome-client "awesome.emit_signal('request::fetch_theme')"
  xsettingsd &
  kill -9 $(pidof xsettingsd)
  # TODO: fix this
  for b in true false; do
    gsettings set org.blueman.general symbolic-status-icons $b
  done
  # Gnome stuff
  gsettings set org.gnome.desktop.interface color-scheme prefer-$THEME
} &>/dev/null

# vim: set ts=2 sts=2 sw=2 et :
